#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

if test "$prefix" = "NONE"; then
	prefix=${ac_default_prefix}
fi

AC_INIT(configure.in)
AC_CONFIG_HEADER(config.h)
AC_CONFIG_SRCDIR([src/gmic.cpp])
AM_MAINTAINER_MODE

PACKAGE=gmic
VERSION=1.5

AM_INIT_AUTOMAKE([$PACKAGE], [$VERSION])

# Checks for mandatory programs.
AC_PROG_CXX
AC_PROG_CC
AC_PROG_MAKE_SET
GIMP_REQUIRED_VERSION=2.4.0
PKG_CHECK_MODULES(GIMP,
  gimp-2.0 >= $GIMP_REQUIRED_VERSION gimpui-2.0 >= $GIMP_REQUIRED_VERSION)

# Checks for mandatory libraries.
#AC_CHECK_LIB([Magick++], [InitializeMagick],,
#[
#    echo "***"
#    echo "** Fatal Error : Header or library files for 'libMagick++' are missing but are mandatory to compile G'MIC. **"
#    echo "***"
#    exit -1
#])
AC_CHECK_LIB([Xext], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libXext' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
AC_CHECK_LIB([Xrandr], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libXrandr' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
AC_CHECK_LIB([avcodec], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libavcodec' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
AC_CHECK_LIB([avformat], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libavformat' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
AC_CHECK_LIB([swscale], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libswscale' are missing but are mandatory to compile G'MIC.
    **" echo "***"
    exit -1
])
AC_CHECK_LIB([jpeg], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libjpeg' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
AC_CHECK_LIB([m], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libm' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
#AC_CHECK_LIB([nsl], [main],,
#[
#    echo "***"
#    echo "** Fatal Error : Header or library files for 'libnsl' are missing but are mandatory to compile G'MIC. **"
#    echo "***"
#    exit -1
#])
AC_CHECK_LIB([png], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libpng' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
AC_CHECK_LIB([pthread], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libpthread' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
AC_CHECK_LIB([rt], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'librt' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
AC_CHECK_LIB([tiff], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libtiff' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
AC_CHECK_LIB([z], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libz' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
AC_CHECK_LIB([fftw3], [main],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'libfftw3' are missing but are mandatory to compile G'MIC. **"
    echo "***"
    exit -1
])
#AC_CHECK_LIB([GraphicsMagick++], [InitializeMagick],,
#[
#    echo "***"
#    echo "** Fatal Error : Header or library files for 'GraphicsMagick++' are missing but are mandatory to compile G'MIC. **"
#    echo "***"
#    exit -1
#])
AC_CHECK_LIB([IlmImf], [ImfInputReadPixels],,
[
    echo "***"
    echo "** Fatal Error : Header or library files for 'Openexr' are missing but are necessary to compile G'MIC. **"
    echo "***"
    exit -1;
])
#AC_CHECK_LIB([cv], [cvSobel],,
#[
#    echo "***"
#    echo "** Fatal Error : Header or library files for 'OpenCV (core)' are missing but are mandatory to compile G'MIC. **"
#    echo "***"
#    exit -1
#])
#AC_CHECK_LIB([highgui], [main],,
#[
#    echo "***"
#    echo "** Fatal Error : Header or library files for 'OpenCV (highgui)' are missing but are mandatory to compile G'MIC. **"
#    echo "***"
#    exit -1
#])

# Checks for header files.
AC_PATH_X
AC_CHECK_HEADERS([sys/time.h unistd.h])

# Checks for typedefs, structures, and compiler characteristics.
AC_HEADER_STDBOOL
AC_C_CONST
AC_C_INLINE
AC_TYPE_SIZE_T
AC_HEADER_TIME
AC_STRUCT_TM
AC_TYPE_UINT8_T
AC_C_VOLATILE

# Checks for library functions.
AC_FUNC_ERROR_AT_LINE
AC_FUNC_MALLOC
AC_HEADER_STDC
AC_FUNC_VPRINTF
AC_CHECK_FUNCS([floor gettimeofday memmove memset pow sqrt strcasecmp strncasecmp])

AC_OUTPUT([Makefile])

echo "
Configuration for $PACKAGE $VERSION :
-----------------------------------

  Compiler ........................ : $CXX $CPPFLAGS
  Linker LDFLAGS .................. : $CXX $LDFLAGS $LIBS
  CXXFLAGS ........................ : $CXXFLAGS
  INSTALL gmic .................... : $prefix/bin/gmic

  Now type 'make' to build the full version of $PACKAGE $VERSION,
  or go to the 'src/' directory and type 'make gimp' to compile
  the Gimp plug-in only, and then type (under root) 'make install' for installation.
"
